// User Service gRPC Definition
syntax = "proto3";

package financial_planning.user.v1;

import "google/protobuf/timestamp.proto";
import "google/protobuf/empty.proto";

option go_package = "github.com/financial-planning/proto/user/v1";

// User Service for authentication and profile management
service UserService {
  // Authentication methods
  rpc Authenticate(AuthenticateRequest) returns (AuthenticateResponse);
  rpc ValidateToken(ValidateTokenRequest) returns (ValidateTokenResponse);
  rpc RefreshToken(RefreshTokenRequest) returns (RefreshTokenResponse);
  rpc Logout(LogoutRequest) returns (google.protobuf.Empty);
  
  // User CRUD operations
  rpc CreateUser(CreateUserRequest) returns (CreateUserResponse);
  rpc GetUser(GetUserRequest) returns (GetUserResponse);
  rpc UpdateUser(UpdateUserRequest) returns (UpdateUserResponse);
  rpc DeleteUser(DeleteUserRequest) returns (google.protobuf.Empty);
  
  // Profile management
  rpc GetProfile(GetProfileRequest) returns (GetProfileResponse);
  rpc UpdateProfile(UpdateProfileRequest) returns (UpdateProfileResponse);
  
  // Preferences
  rpc GetPreferences(GetPreferencesRequest) returns (GetPreferencesResponse);
  rpc UpdatePreferences(UpdatePreferencesRequest) returns (UpdatePreferencesResponse);
  
  // Health check
  rpc HealthCheck(google.protobuf.Empty) returns (HealthResponse);
}

// Authentication messages
message AuthenticateRequest {
  string email = 1;
  string password = 2;
  string device_id = 3;
  string ip_address = 4;
  string user_agent = 5;
}

message AuthenticateResponse {
  string access_token = 1;
  string refresh_token = 2;
  int64 expires_in = 3;
  User user = 4;
}

message ValidateTokenRequest {
  string token = 1;
}

message ValidateTokenResponse {
  bool valid = 1;
  string user_id = 2;
  repeated string permissions = 3;
}

message RefreshTokenRequest {
  string refresh_token = 1;
}

message RefreshTokenResponse {
  string access_token = 1;
  string refresh_token = 2;
  int64 expires_in = 3;
}

message LogoutRequest {
  string user_id = 1;
  string token = 2;
}

// User CRUD messages
message CreateUserRequest {
  string email = 1;
  string password = 2;
  string first_name = 3;
  string last_name = 4;
  string phone = 5;
  google.protobuf.Timestamp date_of_birth = 6;
}

message CreateUserResponse {
  User user = 1;
}

message GetUserRequest {
  string user_id = 1;
}

message GetUserResponse {
  User user = 1;
}

message UpdateUserRequest {
  string user_id = 1;
  string email = 2;
  string first_name = 3;
  string last_name = 4;
  string phone = 5;
  google.protobuf.Timestamp date_of_birth = 6;
}

message UpdateUserResponse {
  User user = 1;
}

message DeleteUserRequest {
  string user_id = 1;
}

// Profile messages
message GetProfileRequest {
  string user_id = 1;
}

message GetProfileResponse {
  UserProfile profile = 1;
}

message UpdateProfileRequest {
  string user_id = 1;
  UserProfile profile = 2;
}

message UpdateProfileResponse {
  UserProfile profile = 1;
}

// Preferences messages
message GetPreferencesRequest {
  string user_id = 1;
}

message GetPreferencesResponse {
  UserPreferences preferences = 1;
}

message UpdatePreferencesRequest {
  string user_id = 1;
  UserPreferences preferences = 2;
}

message UpdatePreferencesResponse {
  UserPreferences preferences = 1;
}

// Health check
message HealthResponse {
  string status = 1;
  google.protobuf.Timestamp timestamp = 2;
}

// Data models
message User {
  string id = 1;
  string email = 2;
  string first_name = 3;
  string last_name = 4;
  string phone = 5;
  google.protobuf.Timestamp date_of_birth = 6;
  UserStatus status = 7;
  google.protobuf.Timestamp created_at = 8;
  google.protobuf.Timestamp updated_at = 9;
}

message UserProfile {
  string user_id = 1;
  int32 annual_income = 2;
  string employment_status = 3;
  string marital_status = 4;
  int32 dependents = 5;
  RiskTolerance risk_tolerance = 6;
  repeated string investment_experience = 7;
  google.protobuf.Timestamp updated_at = 8;
}

message UserPreferences {
  string user_id = 1;
  string currency = 2;
  string timezone = 3;
  string language = 4;
  NotificationSettings notifications = 5;
  PrivacySettings privacy = 6;
  google.protobuf.Timestamp updated_at = 7;
}

message NotificationSettings {
  bool email_enabled = 1;
  bool sms_enabled = 2;
  bool push_enabled = 3;
  repeated string email_types = 4;
  repeated string sms_types = 5;
  repeated string push_types = 6;
  QuietHours quiet_hours = 7;
}

message PrivacySettings {
  bool data_sharing_enabled = 1;
  bool analytics_tracking = 2;
  bool marketing_communications = 3;
}

message QuietHours {
  string start_time = 1;
  string end_time = 2;
  string timezone = 3;
  bool enabled = 4;
}

// Enums
enum UserStatus {
  USER_STATUS_UNSPECIFIED = 0;
  USER_STATUS_ACTIVE = 1;
  USER_STATUS_INACTIVE = 2;
  USER_STATUS_SUSPENDED = 3;
  USER_STATUS_DELETED = 4;
}

enum RiskTolerance {
  RISK_TOLERANCE_UNSPECIFIED = 0;
  RISK_TOLERANCE_CONSERVATIVE = 1;
  RISK_TOLERANCE_MODERATE = 2;
  RISK_TOLERANCE_AGGRESSIVE = 3;
}